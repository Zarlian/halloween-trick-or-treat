<%- contentFor('body') %>

<h1>Edit Location</h1>

<form action="/admin/locations/<%= location.id %>?_method=PUT" method="POST" enctype="multipart/form-data">
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="mb-3">
        <label for="street" class="form-label">Street*</label>
        <input type="text" class="form-control" id="street" name="street" value="<%= location.street %>" required>
      </div>

      <div class="mb-3">
        <label for="number" class="form-label">Number*</label>
        <input type="text" class="form-control" id="number" name="number" value="<%= location.number %>" required>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="lat" class="form-label">Latitude*</label>
          <input type="number" step="any" class="form-control" id="lat" name="lat" value="<%= location.lat %>" required>
        </div>
        <div class="col-md-6 mb-3">
          <label for="lon" class="form-label">Longitude*</label>
          <input type="number" step="any" class="form-control" id="lon" name="lon" value="<%= location.lon %>" required>
        </div>
      </div>

      <div class="mb-3">
        <label for="title" class="form-label">Title</label>
        <input type="text" class="form-control" id="title" name="title" value="<%= location.title || '' %>">
      </div>
    </div>

    <div class="col-md-6">
      <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <textarea class="form-control" id="description" name="description" rows="3"><%= location.description || '' %></textarea>
      </div>

      <div class="mb-3">
        <label for="image" class="form-label">Image</label>
        <input type="file" class="form-control" id="image" name="image" accept="image/*">
        <% if (location.image) { %>
          <div class="mt-2">
            <p>Current image:</p>
            <img src="/uploads/<%= location.image %>" alt="Location image" style="max-width: 100px;">
          </div>
        <% } %>
      </div>

      <div class="mb-3">
        <label for="orderIndex" class="form-label">Order Index</label>
        <input type="number" class="form-control" id="orderIndex" name="orderIndex" value="<%= location.orderIndex || '' %>">
      </div>

      <div class="mb-3">
        <div id="map" style="height: 200px; width: 100%;"></div>
        <p class="form-text">Click on the map to update coordinates</p>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-between">
    <a href="/admin" class="btn btn-secondary">Cancel</a>
    <button type="submit" class="btn btn-primary">Update Location</button>
  </div>
</form>

<%- contentFor('extraScripts') %>
<script>
  // Initialize map
  const map = L.map('map').setView([<%= location.lat %>, <%= location.lon %>], 15);
  
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);
  
  // Add marker for current location
  let marker = L.marker([<%= location.lat %>, <%= location.lon %>]).addTo(map);
  
  // Handle map click to update coordinates
  map.on('click', function(e) {
    const lat = e.latlng.lat;
    const lng = e.latlng.lng;
    
    // Update form fields
    document.getElementById('lat').value = lat;
    document.getElementById('lon').value = lng;
    
    // Update marker position
    marker.setLatLng(e.latlng);
  });
</script>
