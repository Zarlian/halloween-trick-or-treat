<%- contentFor('body') %>

  <div class="w-full">
    <div class="px-4 md:px-6 lg:px-8">
      <h1 class="text-2xl md:text-3xl font-bold mb-4">Story</h1>

      <p class="mb-4 text-white">Scan QR codes along the route to unlock story parts.</p>

      <ul class="space-y-3">
        <% parts.forEach(function(part){ %>
          <li class="border border-halloween-purple rounded p-3 flex items-center justify-between">
            <div>
              <p class="font-semibold"><%= part.title %></p>
              <p class="text-sm text-gray-300">Part <%= part.orderIndex || '-' %></p>
            </div>
            <div>
              <a class="bg-halloween-orange text-white px-3 py-1 rounded hover:opacity-90"
                 href="/stories/part/<%= part.id %>">Open</a>
            </div>
          </li>
        <% }) %>
      </ul>

      <div class="mt-6 text-sm text-gray-300">
        <p>Already scanned a code but can't open? Make sure your browser allows localStorage.</p>
      </div>
    </div>
  </div>

<%- contentFor('extraScripts') %>
<script>
  // Gatekeeping: If a part isn't unlocked in localStorage, redirect to /stories to encourage scanning
  document.querySelectorAll('a[href^="/stories/part/"]').forEach(function(anchor){
    anchor.addEventListener('click', function(e){
      const id = this.getAttribute('href').split('/').pop();
      const unlocked = JSON.parse(localStorage.getItem('unlockedStoryParts') || '[]');
      if (!unlocked.includes(Number(id))) {
        e.preventDefault();
        alert('Scan the QR code to unlock this part!');
      }
    });
  });
</script>

